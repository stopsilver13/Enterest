{% extends "sharespot/place_base.html" %}

{% load staticfiles %}

{% block title %}
    {{ place.name }} 정보공유
{% endblock %}

{% block head_extra_place %}
<link rel="stylesheet" type="text/css" href="{% static 'css/place_share.css' %}">
{% endblock %}

{% block content_place %}
  <div class="place_around_content">
    <div class="place_around_content_wrapper">
      <div class="posting_zone">
        <div class="posting_zone_nav">
          <div class="posting_zone_nav_compenent selected"> 전체 </div>
          {% for category in share_category %}
            <div class="posting_zone_nav_compenent"> {{ category.name }} </div>
          {% endfor %}
        </div>
        <div class="posting_input_section">
          <div class="input_box">
            <div class="input_left">
              <div class="posting_place_info">
                <div class="place_category"> 분류 선택 </div>
                <input class="place_name" placeholder="방문 장소,주소 검색" name="q" data-url="{% url 'sharespot:place_share_search' space.en_name %}">
                <div class="place_pic"> 사진 </div>
              </div>
              <textarea placeholder="자유롭게 입력해주세요."></textarea>
            </div>
            <input type="hidden" name="address">
            <input type="hidden" name="lat_lon">
            <button> 등록 </button>
          </div>

          <div id="items_list">
          </div>
        </div>
              {{ item.title|safe }} {{ item.address }}
        {% for info in share_info %}
          {% include 'sharespot/place_share_info.html' with user=user info=info %}
        {% endfor %}
      </div>
      <div class="map"></div>
    </div>
  </div>


<script>
$(function(){
  var map_position = $('.map').offset().top;
  $(window).scroll(function(){
    if( $(window).scrollTop() >= map_position ) {
         $("#navi").css("position","fixed");
         $("#navi").css("top","0");
    } else {
         $("#navi").css("position","relative");
         $("#navi").css("top","");
    }
  })
})

function throttle(f, delay) {
  var timer = null;
  return function() {
    var context = this;
    var args = arguments;

    clearTimeout(timer);
    timer = window.setTimeout(function() {
      f.apply(context, args);
    },
    delay || 500);
  };
}

$('.place_name').keyup(throttle(function(e) {
  $('#items_list').show();
  var url = $(this).data('url');
  var data = {
    q : $(this).val()
  }
  if( data.q != "" ) {
    $.get(url, data)
      .done(function(items) {
        $('#items_list').children().each(function(){
          $(this).remove();
        });
        var items = items['items'];
        for( var i in items ) {
          $('#items_list').append($('<div><span id="title">'+ items[i].title + '</span><span id="address">'+ items[i].address +'</span><span id="lat_lon" style="display:none;">'+ String(items[i].mapx) +','+ String(items[i].mapy) +'</div>'));
        }
        $('#items_list > div').click(function() {
          var self = $(this);
          $('.place_name').val(self.children('span#title').text());
          $('input[name="address"]').val(self.children('span#address').text());
          $('input[name="lat_lon"]').val(self.children('span#lat_lon').text());
          self.parent().hide();
        });
    })
  }
}));
</script>
{% endblock %}